<!DOCTYPE html> <html lang=en> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZ2C67981H"></script> <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-SZ2C67981H');
    </script> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1"> <link rel=canonical href=https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/> <title>Docker Compose DNS Consistency (DCDC) | Kevin Jalbert</title> <meta name=description content="Introducing DCDC: a way to work with multiple Docker Compose projects locally with consistent service URLs, internal and external to the Docker network."/> <meta name=keywords content="docker, tools"/> <meta name=datePublished content="2019-09-29 00:00:00 UTC"/> <meta property="og:article:published_time" content="2019-09-29 00:00:00 UTC"/> <meta name=author content="Kevin Jalbert"/> <meta property="og:article:author" content="2019-09-29 00:00:00 UTC"/> <meta name=url content="https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/"/> <meta property="og:url" content="https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/"/> <meta name=site content="Kevin Jalbert"/> <meta property="og:site_name" content="Kevin Jalbert"/> <meta name="twitter:card" content=summary_large_image /> <meta name="twitter:creator" content="@kevinjalbert"/> <meta name="twitter:description" content="Introducing DCDC: a way to work with multiple Docker Compose projects locally with consistent service URLs, internal and external to the Docker network."/> <meta name="twitter:image:src" content="https://kevinjalbert.com/images/2019-09-29-docker-compose-dns-consistency-dcdc/docker.jpg"/> <meta name="twitter:site" content="Kevin Jalbert"/> <meta name="twitter:title" content="Docker Compose DNS Consistency (DCDC)"/> <meta property="og:description" content="Introducing DCDC: a way to work with multiple Docker Compose projects locally with consistent service URLs, internal and external to the Docker network."/> <meta property="og:image" content="https://kevinjalbert.com/images/2019-09-29-docker-compose-dns-consistency-dcdc/docker.jpg"/> <meta property="og:title" content="Docker Compose DNS Consistency (DCDC)"/> <script type="application/ld+json">
    {
       "@context": "http://schema.org",
       "@type": "BlogPosting",
       "headline": "Docker Compose DNS Consistency (DCDC)",
       "keywords": "docker, tools",
       "url": "https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/",
       "datePublished": "2019-09-29 00:00:00 UTC",
       "dateModified": "2019-09-29 00:00:00 UTC",
       "author": {
         "@type": "Person",
         "name": "Kevin Jalbert",
         "sameAs": [
           "https://twitter.com/kevinjalbert",
           "https://github.com/kevinjalbert",
           "https://keybase.io/kevinjalbert",
           "https://reddit.com/user/kevinjalbert"
         ]
       },
       "mainEntityOfPage": {
          "@type": "WebPage",
         "@id": "https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/"
       }
    }
  </script> <link href="/stylesheets/app.css" rel=stylesheet /> <link rel=alternate type="application/atom+xml" title="Articles | Kevin Jalbert" href="/feed.xml"/> </head> <div class=container> <div class=header> <div class="col-xs-12 col-sm-7 navigation"> <a class=banner href="/">Kevin Jalbert</a> <a href="/about/">About</a> <a href="/now/">Now</a> <a href="/uses/">Uses</a> <a href="https://github.com/kevinjalbert/ama/blob/master/README.md">AMA</a> </div> <div class="col-xs-12 col-sm-5 search-component"> <input placeholder=Search class="search ui-autocomplete-input ui-corner-all" autocomplete=on> </div> </div> </div> <body> <div class="container content article"> <div class=row> <div class=col-md-12> <h1 class=article__title><p>Docker Compose DNS Consistency (DCDC)</p> </h1> <div class="row article__meta-info"> <div class="col-xs-4 col-md-4"> <div class="article__date entry-date">September 29, 2019 </div> </div> <div class="col-xs-4 col-md-4"> <div class=article__read-time>3 min read</div> </div> <div class="col-xs-4 col-md-4"> <div class=article__comments> <a href="https://kevinjalbert.com/docker-compose-dns-consistency-dcdc/#disqus_thread">0 Comments</a> </div> </div> </div> <div class="row article__meta-tags"> <div class="col-xs-12 col-md-12"> <div class=article__tags> <a href="/tags/docker/">docker</a> <a href="/tags/tools/">tools</a> </div> </div> </div> <img src=/images/2019-09-29-docker-compose-dns-consistency-dcdc/docker.jpg> <i><p><a href="https://flickr.com/photos/134416355@N07/31744142112" title=Docker-2>Docker-2</a> by <a href="https://flickr.com/people/134416355@N07">maijou2501</a> is licensed under <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA</a></p> </i> <div class=article__separator></div> <div class=newsletter__form> <div class="panel panel-default"> <div class=panel-heading> <h4 class="panel-title accordion-toggle collapsed" data-toggle=collapse data-parent="#accordion" href="#newsletterFormCollapse"> If you enjoy this, consider subscribing to my newsletter </h4> </div> <div id=newsletterFormCollapse class="panel-collapse collapse"> <div class=panel-body> <p style="text-align: center">I aim to publish one article a month</p> <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel=stylesheet> <style>
              #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
              /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                 We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
        </style> <div id=mc_embed_signup> <form action="//kevinjalbert.us14.list-manage.com/subscribe/post?u=fe02783eec556cfc2893fe174&amp;id=aecd14f8e6" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate> <div id=mc_embed_signup_scroll> <input type=email value="" name=EMAIL class=email id=mce-EMAIL placeholder="E-mail address" required> <div style="position: absolute; left: -5000px;" aria-hidden=true><input name=b_fe02783eec556cfc2893fe174_aecd14f8e6 tabindex=-1 value=""></div> <div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button></div> </div> </form> </div> </div> </div> </div> </div> <p>While I&rsquo;m no longer at <a href="https://scoremediaandgaming.com/">theScore</a>, I do recall the larger <em>dockerization</em> efforts that happened near the end of my employment there. It wasn&rsquo;t uncommon to have several services running for the product you were working on. At theScore we used <a href="https://docs.docker.com/compose/">Docker Compose</a> for local development as it eased the setup and took care of running dependencies.</p> <p>This eventually leads to the overall problem of dealing with Docker Compose networking and DNS resolution. I ended up creating a tool called <em>Docker Compose DNS Consistency</em>, <a href="https://github.com/scoremedia/dcdc"><code>dcdc</code></a>, as a way to solve this. The following sections are from the <code>dcdc</code> README file, and I would highly recommend going there right after for more in-depth details on how <code>dcdc</code> actually works.</p> <h1>Problem</h1> <p>We have a project (i.e., <code>proj1</code>) that contains an API (<code>api</code>) service. With Docker, we are able to expose the API server&rsquo;s default port (<code>3000</code>). Thus, <code>localhost:3000</code> routes to the API of <code>proj1</code>. We have another project (i.e., <code>proj2</code>) that also contains an API (<code>api</code>) service, and is also exposed on the default port of <code>3000</code>.</p> <p>Both projects exist as separate repositories and therefore have different <code>docker-compose.yml</code> files. In isolation, both projects run without any problem and expose their respective API service on <code>localhost:3000</code>. The issue is when you want to run both projects at the same time &ndash; which might be needed for the development of a new feature or testing a complete flow.</p> <p>The naive solution is to change one of the exposed ports for a project to <code>3001</code> so that there is no clashing of ports. So for example, <code>proj2</code>&rsquo;s API is now exposed on port <code>3001</code> and is reachable at <code>localhost:3001</code>.</p> <p>There are a few problems here:</p> <ol> <li>This process of ensuring we have no conflicting ports on the host can be painful. Even if the projects aren&rsquo;t related, you can have conflicting ports being exposed. As the number of projects grows, this becomes more challenging. It&rsquo;s likely that a document is needed to keep track of used ports (or port ranges).</li> <li>If the two projects have to communicate to each other internally (i.e., not via the host&rsquo;s web browser), the projects cannot see each other as they are on a different network (by default).</li> <li>Externally to the Docker network, we refer to the APIs as <code>localhost:&lt;port&gt;</code>, but internally we need to use the <em>service name</em> like <code>proj1</code>&rsquo;s <code>api</code>. There is a disconnect in how we <em>refer</em> to the services internally and externally to the Docker network.</li> </ol> <h1>Solution</h1> <p>DCDC&rsquo;s purpose is to provide an easy way to work with multiple Docker Compose projects locally by:</p> <ol> <li>Exposing fully qualified domain names for each service (ending in <code>.test</code>) using DNS and reverse proxy.</li> <li>Providing consistent DNS resolution for services internal and external to the Docker network (i.e., <code>db.proj.test</code> is accessible on the host machine and also from a service&rsquo;s container).</li> <li>Requiring as little configuration to projects to make them work with DCDC.</li> </ol> <p><em>NOTE: at the time of publication, DCDC only works with macOS. It&rsquo;s likely possible to work for other operating systems, although it will require some rejigging.</em></p> <p>The following is the test output of <code>dcdc</code> that demonstrates accessibility to services external and internal to the Docker network. Not only are HTTP services accessible, but also non-HTTP services (i.e., a database).</p> <p><img alt="Dcdc tests" width=1784 height=968 src="/images/2019-09-29-docker-compose-dns-consistency-dcdc/dcdc-tests.png"/></p> <div class=article__comments-button><button type=button class="btn btn-default show-comments">Click to Disqus</button></div> <div id=disqus_thread></div> </div> </div> </div> <script>
//<![CDATA[
    var disqus_shortname = 'kevinjalbert';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script> </body> <div class="container footer"> <div class="col-md-12 footer__social"> <a href="https://twitter.com/KevinJalbert">Twitter</a> <a href="https://github.com/kevinjalbert">GitHub</a> <a href="https://stackoverflow.com/users/583592/kevin-jalbert">Stack Overflow</a> </div> <div class="col-md-12 footer__copywrite"> Code licensed <a href="https://github.com/kevinjalbert/kevinjalbert.github.io/blob/real-master/LICENSE">MIT</a>, Content &copy; 2019 Kevin Jalbert </div> </div> </html> <script src="/javascripts/app.js"></script>