<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1"> <script>addEventListener('error', window.__e=function f(e){f.q=f.q||[];f.q.push(e)});</script> <link rel=canonical href=https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/> <title>Todoist with Keyboard Navigation via Nativefier | Kevin Jalbert</title> <meta name=description content="Todoist does not have strong keyboard navigation and shortcuts. Fortunately, there is a browser extension that augments the web client to support better keyboard navigation. This article outlines h..."/> <meta name=keywords content="productivity, tools"/> <meta name=datePublished content="2018-09-30 00:00:00 UTC"/> <meta property="og:article:published_time" content="2018-09-30 00:00:00 UTC"/> <meta name=author content="Kevin Jalbert"/> <meta property="og:article:author" content="2018-09-30 00:00:00 UTC"/> <meta name=url content="https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/"/> <meta property="og:url" content="https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/"/> <meta name=site content="Kevin Jalbert"/> <meta property="og:site_name" content="Kevin Jalbert"/> <meta name="twitter:card" content=summary_large_image /> <meta name="twitter:creator" content="@kevinjalbert"/> <meta name="twitter:description" content="Todoist does not have strong keyboard navigation and shortcuts. Fortunately, there is a browser extension that augments the web client to support better keyboard navigation. This article outlines how to gain this functionality in a desktop version of Todoist using 'nativefier'."/> <meta name="twitter:image:src" content="https://kevinjalbert.com/images/2018-09-30-todoist-with-keyboard-navigation-via-nativefier/todoist-keyboard.jpg"/> <meta name="twitter:site" content="Kevin Jalbert"/> <meta name="twitter:title" content="Todoist with Keyboard Navigation via Nativefier"/> <meta property="og:description" content="Todoist does not have strong keyboard navigation and shortcuts. Fortunately, there is a browser extension that augments the web client to support better keyboard navigation. This article outlines how to gain this functionality in a desktop version of Todoist using 'nativefier'."/> <meta property="og:image" content="https://kevinjalbert.com/images/2018-09-30-todoist-with-keyboard-navigation-via-nativefier/todoist-keyboard.jpg"/> <meta property="og:title" content="Todoist with Keyboard Navigation via Nativefier"/> <script type="application/ld+json">
    {
       "@context": "http://schema.org",
       "@type": "BlogPosting",
       "headline": "Todoist with Keyboard Navigation via Nativefier",
       "keywords": "productivity, tools",
       "url": "https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/",
       "datePublished": "2018-09-30 00:00:00 UTC",
       "dateModified": "2018-09-30 00:00:00 UTC",
       "author": {
         "@type": "Person",
         "name": "Kevin Jalbert",
         "sameAs": [
           "https://twitter.com/kevinjalbert",
           "https://github.com/kevinjalbert",
           "https://keybase.io/kevinjalbert",
           "https://reddit.com/user/kevinjalbert"
         ]
       },
       "mainEntityOfPage": {
          "@type": "WebPage",
         "@id": "https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/"
       }
    }
  </script> <link href="/stylesheets/app.css" rel=stylesheet /> <link rel=alternate type="application/atom+xml" title="Articles | Kevin Jalbert" href="/feed.xml"/> <script async src="/vendor/analytics/index.js"></script> <script async src="https://www.google-analytics.com/analytics.js"></script> </head> <div class=container> <div class=header> <div class="col-xs-12 col-sm-7 navigation"> <a class=banner href="/">Kevin Jalbert</a> <a href="/about/">About</a> <a href="/now/">Now</a> <a href="https://github.com/kevinjalbert/ama/blob/master/README.md">AMA</a> </div> <div class="col-xs-12 col-sm-5 search-component"> <input placeholder=Search class="search ui-autocomplete-input ui-corner-all" autocomplete=on> </div> </div> </div> <body> <div class="container content article"> <div class=row> <div class=col-md-12> <h1 class=article__title><p>Todoist with Keyboard Navigation via Nativefier</p> </h1> <div class="row article__meta-info"> <div class="col-xs-4 col-md-4"> <div class="article__date entry-date">September 30, 2018 </div> </div> <div class="col-xs-4 col-md-4"> <div class=article__read-time>2 min read</div> </div> <div class="col-xs-4 col-md-4"> <div class=article__comments> <a href="https://kevinjalbert.com/todoist-with-keyboard-navigation-via-nativefier/#disqus_thread">0 Comments</a> </div> </div> </div> <div class="row article__meta-tags"> <div class="col-xs-12 col-md-12"> <div class=article__tags> <a href="/tags/productivity/">productivity</a> <a href="/tags/tools/">tools</a> </div> </div> </div> <img src=/images/2018-09-30-todoist-with-keyboard-navigation-via-nativefier/todoist-keyboard.jpg> <i><p>My MacBook Pro displaying &quot;TODOIST&quot;</p> </i> <div class=article__separator></div> <p><a href="https://todoist.com">Todoist</a> is a powerful task manager. It offers a <a href="https://itunes.apple.com/ca/app/todoist-organize-your-life/id585829637">MacOS Application</a> that provides a desktop experience and a dedicated <em>quick task adding</em> feature. I am a poweruser of the keyboard (i.e., I use <a href="https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?hl=en">Vimium</a> in Chrome), and my big issue is that Todoist doesn&rsquo;t offer strong keyboard navigation. Fortunately, <a href="https://github.com/mgsloan/todoist-shortcuts">todoist-shortcuts</a> adds much-needed keyboard navigation to the web client as a browser extension.</p> <p>I enjoy having <em>dedicated tools/applications</em> for tasks and tend to keep my browser for ephemeral tasks. Therefore I wanted to keep Todoist as a desktop application but with the keyboard navigation extension.</p> <h2>Web Application -&gt; Desktop Application</h2> <p>I&rsquo;ve used <a href="https://github.com/jiahaog/nativefier">nativefier</a> in the past to create a desktop version of various web applications. Quick searching showed the following <a href="https://github.com/jiahaog/nativefier/issues/207">issue</a> mentioning that adding a Chrome extention isn&rsquo;t supported, although it is possible to <em>inject</em> custom JavaScript to be executed within the newly created application.</p> <p>The following command will build the application while injecting <a href="https://github.com/mgsloan/todoist-shortcuts/blob/v22/src/todoist-shortcuts.js"><code>src/todoist-shortcuts.js</code></a> in it. The injected file contains all of the keyboard navigation of <code>todoist-shortcuts</code>. In addition, other options were provided to <code>nativefier</code> so that we have support for badge counts and bouncing the dock icon on changes when out of focus (MacOS).</p> <div class=highlight><pre class="highlight shell"><code>nativefier <span class="s1">'https://todoist.com/'</span> <span class="nt">--name</span> <span class="s1">'Todoist'</span> <span class="nt">--icon</span> ./todoist-icon.png <span class="nt">--inject</span> ./todoist-shortcuts-22/src/todoist-shortcuts.js <span class="nt">--counter</span> <span class="nt">--bounce</span> <span class="nt">--single-instance</span>
</code></pre></div> <p>The produced application works as expected. Keyboard navigation exists within the <code>nativefier</code> created application. Unfortunately, the badge count aspect did not&hellip;</p> <h3>Supporting Badge Count</h3> <p>The reason the badge count didn&rsquo;t work is because <code>nativefier</code> is looking in the title of the window/application for the number (using a regular expression). To solve this, we will need some additional JavaScript that will propagate the number of tasks in <em>Today</em> into the title (while handling edge cases). It isn&rsquo;t the prettiest, but the following <code>counter.js</code> snippet does the trick:</p> <div class=highlight><pre class="highlight javascript"><code><span class="c1">// Returns the count for the 'Today' list (defaults to 0)</span>
<span class="kd">function</span> <span class="nx">currentCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#top_filters &gt; li:nth-child(2) &gt; span.item_content &gt; small'</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Returns the title without any annotated count</span>
<span class="kd">function</span> <span class="nx">titleWithoutCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">indexOfCount</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">" ("</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">indexOfCount</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">title</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">indexOfCount</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">title</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Returns the existing count from the title (defaults to 0)</span>
<span class="kd">function</span> <span class="nx">existingCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">indexOfCount</span> <span class="o">=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">" ("</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">title</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">indexOfCount</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">title</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// Update badge count based on the number in Today</span>
<span class="kd">function</span> <span class="nx">updateBadgeCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">currentCount</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">titleWithoutCount</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">newTitle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">newTitle</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">!==</span> <span class="nx">existingCount</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">newTitle</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2"> (</span><span class="p">${</span><span class="nx">count</span><span class="p">}</span><span class="s2">)`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">!==</span> <span class="nx">newTitle</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">newTitle</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Update the badge every 5 seconds</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">updateBadgeCount</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>

<span class="c1">// Update the badge when the title changes</span>
<span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">updateBadgeCount</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">observe</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'title'</span><span class="p">),</span> <span class="p">{</span>
    <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">characterData</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div> <p>Unfortunately, <code>nativefier</code> has an issue with <a href="https://github.com/jiahaog/nativefier/issues/458">injecting multiple JavaScript files</a>. As a workaround, we concatenate the JavaScript into one file before <em>injecting it</em> (which fortunately works with the JavaScript we have).</p> <div class=highlight><pre class="highlight shell"><code><span class="c">#!/bin/bash</span>
<span class="nb">cat</span> ./counter.js <span class="o">&gt;</span> todoist.js<span class="p">;</span> <span class="nb">cat</span> ./todoist-shortcuts-22/src/todoist-shortcuts.js <span class="o">&gt;&gt;</span> todoist.js
nativefier <span class="s1">'https://todoist.com/'</span> <span class="nt">--name</span> <span class="s1">'Todoist'</span> <span class="nt">--icon</span> ./todoist-icon.png <span class="nt">--inject</span> ./todoist.js <span class="nt">--counter</span> <span class="nt">--bounce</span> <span class="nt">--single-instance</span> <span class="nt">--overwrite</span>
</code></pre></div> <h2>Desktop Todoist with Keyboard Navigation</h2> <p>At this point, we&rsquo;ve successfully wrapped the web client of Todoist for Desktop while injecting <code>todoist-shortcuts</code>. Badge support is preserved and notifications continue to function.</p> <p>I still like the <em>quick task adding</em> feature of the original Todoist application on the desktop, but unfortunately, that was outside the scope of what I could do with <code>nativefier</code>. As a workaround, I&rsquo;ve renamed the original application to <code>Todoist-store</code> and moved the new application over with no naming conflicts. I run both applications so that I can continue to use the <em>quick task adding</em> feature, although I hide <code>Todist-store</code>in the tray and prevent any notifications from appearing.</p> <p>To simplify the process of extending/modifying/building this solution, I&rsquo;ve put together the following <a href="https://github.com/kevinjalbert/todoist-shortcuts-nativefier">repository on GitHub</a>. I hope that Todoist simply adds better keyboard navigation in their client by default&hellip; but until then, I&rsquo;ll be using this solution.</p> <div class=newsletter__form> <div class="panel panel-default"> <div class=panel-heading> <h4 class="panel-title accordion-toggle collapsed" data-toggle=collapse data-parent="#accordion" href="#newsletterFormCollapse"> Signup for my Newsletter </h4> </div> <div id=newsletterFormCollapse class="panel-collapse collapse"> <div class=panel-body> <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel=stylesheet> <style>
              #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
              /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                 We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
        </style> <div id=mc_embed_signup> <form action="//kevinjalbert.us14.list-manage.com/subscribe/post?u=fe02783eec556cfc2893fe174&amp;id=aecd14f8e6" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate> <div id=mc_embed_signup_scroll> <input type=email value="" name=EMAIL class=email id=mce-EMAIL placeholder="email address" required> <div style="position: absolute; left: -5000px;" aria-hidden=true><input name=b_fe02783eec556cfc2893fe174_aecd14f8e6 tabindex=-1 value=""></div> <div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button></div> </div> </form> </div> </div> </div> </div> </div> <div class=article__comments-button><button type=button class="btn btn-default show-comments">Click to Disqus</button></div> <div id=disqus_thread></div> </div> </div> </div> <script>
//<![CDATA[
    var disqus_shortname = 'kevinjalbert';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script> </body> <div class="col-md-12 footer__copywrite"> &copy; 2018 Kevin Jalbert </div> </html> <script src="/javascripts/app.js"></script>